<?php

use Krystal\Grid\Grid;
use Krystal\Form\Element;
use Krystal\Iso\ISO3166\Country;

?>

<form action="<?= $route; ?>">

<div class="summary">
    <h4 class="page-header"><i class="glyphicon glyphicon-user"></i> <?php $this->show($title); ?> 
        <?php if ($paginator->getSummary() != 0): ?>
        <small> (<?php $this->show('Displayed'); ?> <?= $paginator->getSummary(); ?> <?php $this->show('of'); ?> <?= $paginator->getTotalAmount(); ?>) </small>
        <?php endif; ?>
    </h4>

    <button class="btn btn-primary" type="submit" onclick="this.form.submit()"><i class="glyphicon glyphicon-search"></i> <? $this->show('Filter'); ?></button>
</div>

<div class="table-responsive">
    <?= Grid::render($data, [
        // A column to be considered as a primary key
        'pk' => 'id',
        'batch' => false,
        'tableClass' => 'table table-hover table-bordered table-striped table-condensed',
        'columns' => [
            [
                'column' => 'id',
                'label' => 'ID'
            ],

            [
                'column' => 'country',
                'label' => 'Country',
                'type' => 'select',
                'filter' => $countries,
                'value' => function($row){
                    $country = new Country();
                    return $country->getCountryByCode($row['country']);
                }
            ],

            [
                'column' => 'full_name',
                'type' => 'text',
                'filter' => true,
                'label' => 'Full name',
            ],

            [
                'column' => 'room_id',
                'type' => 'select',
                'filter' => $rooms,
                'label' => 'Room',
                'hidden' => !$showRooms,
                'value' => function($row){
                    return $row['room'];
                }
            ],

            [
                'column' => 'state',
                'type' => 'select',
                'filter' => $this->translator->translateArray($reservationCollection->getAll()),
                'label' => 'Reservation state',
                'translateable' => true,
                'value' => function($row) use ($reservationCollection){
                    return $reservationCollection->findByKey($row['state']);
                }
            ],

            [
                'column' => 'arrival',
                'type' => 'text',
                'filter' => true,
                'label' => 'Arrival',
            ],

            [
                'column' => 'departure',
                'type' => 'text',
                'filter' => true,
                'label' => 'Departure',
            ]
        ],

        'actions' => [
            'view' => function($row){
                return sprintf('<a href="/reservation/view/%s" data-button="view"><i class="glyphicon glyphicon-search"></i></a>', $row['id']);
            },
            'update' => function($row){
                return sprintf('<a href="/reservation/edit/%s"><i class="glyphicon glyphicon-pencil"></i></a>', $row['id']);
            },
            'delete' => function($row){
                return sprintf('<a href="/reservation/delete/%s"><i class="glyphicon glyphicon-remove"></i></a>', $row['id']);
            }
        ]

    ], $this->translator, $route, $query); ?>

</div>

<? $this->loadPartial('pagination'); ?>

</form>

<? $this->loadPartial('client-modal'); ?>
